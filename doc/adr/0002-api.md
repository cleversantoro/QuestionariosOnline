# ADR 0002 - API de Questionarios

- **Status**: Aceito  
- **Decisao**: Construir a API em ASP.NET Core 9 (Web API) com controllers finos, servicos de aplicacao e repositorios EF Core. Expor endpoints REST/JSON para survey, questions, responses, results e users, com Swagger para descoberta. Publicar mensagens de resposta via `IQueueClient` e usar `ICacheService` para charts.
- **Contexto**: A API e o ponto central para fronts e futuros consumidores. O time ja possui dominio, DTOs e reposit√≥rios EF Core, e precisa validar regras (janela de survey ativa, fechamento, etc.). Performance de leitura de charts precisa de cache, e processamento de respostas deve poder ser desacoplado.
- **Alternativas consideradas**:
  - Minimal APIs: optou-se por controllers para alinhar com Swagger out-of-the-box e consistencia com restante do stack MVC.
  - Dapper puro: EF Core preferido pela produtividade e tracking; Dapper permanece opcao futura para hotspots.
  - Processar respostas direto no request: descartado para nao travar usuario; fila permite escalar.
- **Consequencias**:
  - Pipeline conhecido (DI, filtros, Middlewares) e testes integraveis com WebApplicationFactory.
  - Camada de aplicacao concentra regras e orquestracao; dominios usam `IDateTimeProvider` para testabilidade.
  - Dependencia de cache e fila via interfaces; hoje stubs (InMemory/Console) atendem dev, mas producao requer providers reais + health checks.
  - Necessidade de manter migrations atualizadas e de cobrir endpoints sensiveis com autenticacao/autorizar.
